{* Smarty *}

{extends file="framework.html"}

{block name=css}{/block}

{block name=page}
<div class="row">
  <div class="col-lg-12">
    <h1 class="page-header frobo fw300"><i class="fa fa-users"></i>&nbsp;Client Editor</h1>
  </div>
  <!-- /.col-lg-12 -->
</div>
<!-- /.row -->
{if isset($notifs.client_added)}
<div class="row">
  <div class="col-lg-12">
    <div class="alert alert-info" role="alert">You Client is now added to Server. Please use the generated Auth Token to gain access to Client services.</div>
  </div>
</div>
{/if}
{if isset($notifs.queue_flushed)}
<div class="row">
  <div class="col-lg-12">
    <div class="alert alert-warning" role="alert">All pending messages to this Client were flushed.</div>
  </div>
</div>
{/if}
{if isset($notifs.no_logfile)}
<div class="row">
  <div class="col-lg-12">
    <div class="alert alert-danger" role="alert">No log file is available for this Client just yet.</div>
  </div>
</div>
{/if}
{if isset($notifs.regen_done)}
<div class="row">
  <div class="col-lg-12">
    <div class="alert alert-warning" role="alert">New Auth Token has been generated! You should update every App that was using it to this new Auth Token!<br />
    Auth Token: <strong>{$data.auth_token}</strong>
    </div>
  </div>
</div>
{/if}
<div class="row">
  <div class="col-lg-12">
    <form class="form-horizontal" role="form" method="post" action="index.php">
    <input type="hidden" name="w" value="client">
    <input type="hidden" name="s" value="save">
    <input type="hidden" name="IDclient" value="{$data.IDclient}">

      <div class="form-group">
        <label for="clientname" class="col-sm-2 control-label">Name:</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" id="clientname" name="clientname" placeholder="Name your Client" value="{$data.clientname}">
        </div>
      </div>
      <div class="form-group">
        <label for="auth_token" class="col-sm-2 control-label">Auth Token:</label>
        <div class="col-sm-10">

{if $data.IDclient > 0}
          <div class="input-group">
            <input type="text" class="form-control" id="auth_token" name="auth_token" value="{$data.auth_token}" readonly="readonly">
            <span class="input-group-btn">
              <a class="btn btn-danger" href="?w=client&s=regenauthtoken&IDclient={$data.IDclient}" onclick="javascript:if(!confirm('Are you sure you want to change Auth Token ?')) { return false; }"><i class="glyphicon glyphicon-random"></i>&nbsp;Re-generate</a>
            </span>
          </div>
{else}
          <span class="form-control" style="box-shadow: none !important; border: none !important; padding-left: 0px !important">
            <span class="text-muted">
            Auth Token will be automatically generated after you finish adding this new Client!
            </span>
          </span>
{/if}

        </div>
      </div>

{if $data.IDclient > 0}
      <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
        	<img src="index.php?w=client&s=qrcode&IDclient={$data.IDclient}" border="0">
        </div>
      </div>
{/if}

      <div class="form-group">
        <label for="IDbase" class="col-sm-2 control-label">Linked Bases:</label>
        <div class="col-sm-10">
          <select name="IDbase[]" id="IDbase" size="10" multiple class="form-control">
						{html_options values=$IDbase_val output=$IDbase_opt selected=$IDbase_sel}
          </select>
          <span class="text-muted"><em>Use CTRL key to select multiple Bases</em></span>
        </div>
      </div>

{if $data.IDclient > 0}

      <div class="form-group">
        <label for="" class="col-sm-2 control-label">Current Sequence No:</label>
        <div class="col-sm-10">
          <span class="form-control" style="box-shadow: none !important; border: none !important; padding-left: 0px !important">
          TXclient: <span class="badge {if $data.TXclient > 1000000}alert-danger{else}alert-success{/if}">{$data.TXclient}</span>
          {if $data.online == 1}
          	<em>Client is currently online, so this value is the one we had on Clients last disconnect.</em>
          {/if}
          </span>
        </div>
      </div>

      <div class="form-group">
        <label for="" class="col-sm-2 control-label">Pending Messages:</label>
        <div class="col-sm-10">
          {if $data.pending_messages > 0}
          <a class="btn btn-danger" href="?w=client&s=flush&IDclient={$data.IDclient}" onclick="javascript:if(!confirm('Are you sure you want to flush the TX Queue ?')) { return false; }">Flush ({$data.pending_messages})</a>
          {else}
          <span class="form-control" style="box-shadow: none !important; border: none !important; padding-left: 0px !important">
            <span class="text-muted">
            Great, no pending messages!
            </span>
          </span>
          {/if}
        </div>
      </div>

      <div class="form-group">
        <label for="" class="col-sm-2 control-label">Server LOG:</label>
        <div class="col-sm-10">
          {if $log_available}
          <a class="btn btn-info" href="?w=client&s=getlog&IDclient={$data.IDclient}" target="_blank">Download</a>
          {else}
          <span class="form-control" style="box-shadow: none !important; border: none !important; padding-left: 0px !important">
            <span class="text-muted">
            When the Client connects for the first time the log file will be created. Now it is just empty.
            </span>
          </span>
          {/if}
        </div>
      </div>

{/if}

      <div class="form-group">
        <div class="col-lg-12">
          <button class="btn btn-primary" type="submit"><span class="glyphicon glyphicon-save"></span>&nbsp;{if $data.IDclient > 0}Save Changes{else}Add Client{/if}</button>
			  </div>
      </div>

    </form>
  </div>
</div>
{/block}

{block name=javascripts}{/block}